trigger:
  batch: true
  branches:
    include:
    - main
    exclude: []

pr:
  branches:
  - main

variables: []

stages:
- stage: Build
  displayName: Build
  dependsOn: []
  variables: []
  jobs:
  - job: Build
    displayName: Build and test
    dependsOn: []
    pool:
      vmImage: windows-latest
      demands: []
      name: Azure Pipelines
    variables: []
    steps:
    - bash: >-
        dotnet build eng/Sharpliner.CI/Sharpliner.CI.csproj

        if [[ `git status --porcelain | grep -i '.ya\?ml$'` ]]; then
            echo 'Please rebuild eng/Sharpliner.CI/Sharpliner.CI.csproj and commit the YAML changes'
            exit 1
        else
            echo 'No YAML changes needed'
            exit 0
        fi
      displayName: Validate YAML is published

    - task: UseDotNet@2
      displayName: Install .NET 6 preview 3
      inputs:
        packageType: sdk
        version: 6.0.100-preview.3.21202.5

    - task: DotNetCoreCLI@2
      displayName: dotnet build
      inputs:
        command: build
        includeNuGetOrg: true
        projects: Sharpliner.sln

    - task: UseDotNet@2
      displayName: Install .NET 5
      inputs:
        packageType: sdk
        version: 5.0.202

    - task: DotNetCoreCLI@2
      displayName: dotnet test
      inputs:
        command: test
        includeNuGetOrg: true
        projects: Sharpliner.sln
