trigger:
  batch: true
  branches:
    include:
    - main

pr:
  branches:
    include:
    - main

jobs:
  - job: Build
    displayName: Build and test
    pool:
      name: Azure Pipelines
      vmImage: windows-latest

    steps:
    # dotnet build fails with .NET 5 SDK and the new() statements
    - task: UseDotNet@2
      displayName: Install .NET 6 preview 3
      inputs:
        packageType: sdk
        version: 6.0.100-preview.3.21202.5

    - task: DotNetCoreCLI@2
      displayName: dotnet build
      inputs:
        command: build
        includeNuGetOrg: true
        projects: Sharpliner.sln

    # dotnet test somehow doesn't work with .NET 6 SDK
    - task: UseDotNet@2
      displayName: Install .NET 5
      inputs:
        packageType: sdk
        version: 5.0.202

    - task: DotNetCoreCLI@2
      displayName: dotnet test
      inputs:
        command: test
        projects: Sharpliner.sln
