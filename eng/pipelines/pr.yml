###
### DO NOT MODIFY THIS FILE!
###
### This YAML was auto-generated from PullRequestPipeline
### To make changes, change the C# definition and rebuild its project
###

trigger:
  batch: true
  branches:
    include:
    - main

pr:
  branches:
    include:
    - main

jobs:
- job: Build
  displayName: Build and test
  pool:
    name: Azure Pipelines
    vmImage: windows-2022
  steps:
  - template: templates/install-dotnet-sdk.yml
    parameters:
      version: 8.0.204

  - powershell: |-
      New-Item -Path 'artifacts' -Name 'packages' -ItemType 'directory'
    displayName: Create artifacts/packages

  - task: DotNetCoreCLI@2
    displayName: Build
    inputs:
      command: build
      projects: src/**/*.csproj
      includeNuGetOrg: true

  - task: DotNetCoreCLI@2
    displayName: Validate YAML has been published
    inputs:
      command: build
      projects: eng/Sharpliner.CI/Sharpliner.CI.csproj
      arguments: -p:FailIfChanged=true

  - task: DotNetCoreCLI@2
    displayName: Run unit tests
    inputs:
      command: test
      projects: tests/Sharpliner.Tests/Sharpliner.Tests.csproj

  - task: DotNetCoreCLI@2
    displayName: E2E tests - Pack E2E.Tests library
    inputs:
      command: pack
      packagesToPack: tests/E2E.Tests/SharplinerLibrary/E2E.Tests.SharplinerLibrary.csproj
      configurationToPack: Release
      outputDir: artifacts/packages
      workingDirectory: tests/E2E.Tests

  - task: DotNetCoreCLI@2
    displayName: Build NuGet reference test
    inputs:
      command: build
      projects: tests/E2E.Tests/ProjectUsingTheLibraryNuGet/E2E.Tests.ProjectUsingTheLibraryNuGet.csproj
      includeNuGetOrg: false
      workingDirectory: tests/E2E.Tests

  - task: DotNetCoreCLI@2
    displayName: Build project reference test
    inputs:
      command: build
      projects: tests/E2E.Tests/ProjectUsingTheLibrary/E2E.Tests.ProjectUsingTheLibrary.csproj
      includeNuGetOrg: false
      workingDirectory: tests/E2E.Tests
