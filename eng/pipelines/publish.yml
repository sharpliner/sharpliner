### 
### DO NOT MODIFY THIS FILE!
### 
### This YAML was auto-generated from PublishPipeline.cs
### To make changes, change the C# definition and rebuild its project
### 

jobs:
- job: Publish
  displayName: Publish to nuget.org
  pool:
    name: Azure Pipelines
    vmImage: windows-latest
  steps:
  - powershell: |+
      $tag = git tag --points-at HEAD
      if ("" -eq "$tag") {
      # TODO do not check it
      #    Write-Host '##vso[task.complete result=Failed;]No git tag with version found'
      #  exit 1
          $tag = "1.2.3"
      }

      Write-Host "##vso[task.setvariable variable=packageVersion]$tag"
    displayName: Detect package version

  - template: templates/install-dotnet.yml
    parameters:
      version: 6.0.100-rc.2.21505.57

  - powershell: |-
      New-Item -Path 'artifacts' -Name 'packages' -ItemType 'directory'
    displayName: Create artifacts/packages

  - task: DotNetCoreCLI@2
    displayName: Build
    inputs:
      command: build
      projects: src/Sharpliner/Sharpliner.csproj
      includeNuGetOrg: true

  - task: DotNetCoreCLI@2
    displayName: Pack the .nupkg
    inputs:
      command: pack
      projects: src/Sharpliner/Sharpliner.csproj -c Release --output artifacts/packages -p:PackageVersion=$(packageVersion)

  - publish: artifacts/packages/Sharpliner.$(packageVersion).nupkg
    displayName: Publish build artifacts
    artifact: Sharpliner
